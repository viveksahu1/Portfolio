import { defineNuxtModule, addComponent } from '@nuxt/kit';
import { components } from '@oku-ui/primitives/constant';

const index = defineNuxtModule({
  meta: {
    name: "@oku-ui/nuxt",
    configKey: "primitives",
    compatibility: {
      nuxt: ">=3.14"
    }
  },
  defaults: {
    prefix: "",
    components: true
  },
  setup(options) {
    function getComponents() {
      if (typeof options.components === "object") {
        return Object.entries(components).filter(([name]) => options.components[name]).flatMap(([_, components]) => components);
      }
      if (options.components)
        return Object.values(components).flat();
      return [];
    }
    for (const component of getComponents()) {
      addComponent({
        name: `${options.prefix}${component}`,
        export: component,
        filePath: "@oku-ui/primitives"
      });
    }
  }
});

export { index as default };
